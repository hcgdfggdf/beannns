<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pos-Sha: Lexical Augmentation Protocol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Manrope:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8fafc;
            --accent: #d97706; /* Amber 600: The Saffron Hue of Pos-Sha */
        }
        
        /* Ensures smooth transitional displacement for inter-page navigation */
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Manrope', sans-serif;
            background-color: var(--bg-color);
            /* Subtly textured background using a radial grid for visual depth */
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 32px 32px;
            color: #1e293b; /* A profound, dark slate hue */
        }
        /* Designates elements utilizing the Cinzel typeface for an archaic aesthetic */
        .font-ancient { font-family: 'Cinzel', serif; }
        
        /* The 'Frosted Pane' Effect: Imparting a delicate transparency and depth */
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.05);
        }
        /* Input Field State Transitions: Ensuring responsive and visual feedback */
        .input-area { transition: all 0.3s ease; }
        .input-area:focus-within {
            background: white;
            box-shadow: inset 0 0 8px rgba(0,0,0,0.05); /* Enhanced inner shadow */
        }
        
        /* Custom Scrollbar Stylization for Aesthetically Pleasing Overflow */
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; border: 2px solid var(--bg-color); }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* Dynamic Presentation Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade { animation: fadeIn 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }

        /* Elevation Control for the Back-to-Top Mechanism */
        .back-to-top {
            opacity: 0; transform: translateY(25px); pointer-events: none;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .back-to-top.visible { opacity: 1; transform: translateY(0); pointer-events: all; }

        /* The Lexical Reversal Toggle: A deliberate rotational transformation */
        .rotate-180-smooth { transform: rotate(180deg); }
    </style>
</head>
<body id="top" class="min-h-screen flex flex-col items-center py-16 px-6 selection:bg-amber-200 selection:text-amber-900 relative">

    <header class="text-center mb-12 animate-fade w-full max-w-5xl flex flex-col md:flex-row justify-between items-center gap-6 md:gap-0">
        <div class="text-center md:text-left">
            <div class="inline-flex items-center justify-center w-14 h-14 bg-slate-900 text-amber-400 rounded-xl shadow-2xl mb-3 text-3xl transform rotate-3">
                ðŸ“œ
            </div>
            <h1 class="text-4xl md:text-5xl font-ancient font-extrabold text-slate-900 tracking-tighter">Pos-Sha: The Lexeme Engine</h1>
            <p class="text-slate-600 text-sm font-extrabold tracking-[0.3em] uppercase mt-1">The Posti-Sharron Linguistic Augmentation Project</p>
        </div>
        
        <button onclick="document.getElementById('lexicon-compendium').scrollIntoView({behavior: 'smooth'})" 
                class="group flex items-center gap-3 px-6 py-2.5 bg-white border border-slate-300 rounded-full shadow-lg hover:shadow-xl hover:border-amber-400 transition-all duration-300 transform hover:-translate-y-0.5">
            <span class="text-sm font-extrabold text-slate-700 group-hover:text-amber-700 uppercase tracking-widest">Compendium Access</span>
            <svg class="w-5 h-5 text-slate-500 group-hover:text-amber-600 transform group-hover:rotate-180 transition-transform duration-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </button>
    </header>

    <main class="w-full max-w-5xl space-y-10 animate-fade" style="animation-delay: 0.15s;">
        
        <div class="flex justify-center items-center mb-[-30px] z-20 relative">
            <button id="swap-mode-btn" 
                    title="Toggle Translation Direction"
                    class="bg-slate-900 hover:bg-amber-600 text-amber-400 hover:text-white p-4 rounded-full shadow-2xl transition-all duration-500 transform hover:scale-115 active:rotate-180 group">
                <svg class="w-6 h-6 transition-transform duration-700" id="swap-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>
            </button>
        </div>

        <div class="glass-card rounded-[2rem] overflow-hidden shadow-2xl flex flex-col md:flex-row min-h-[480px]">
            
            <div class="flex-1 flex flex-col border-b md:border-b-0 md:border-r border-slate-200 input-area bg-slate-50/70">
                <div class="px-8 py-5 flex justify-between items-center bg-slate-100/30">
                    <span id="input-label" class="text-sm font-extrabold text-slate-500 uppercase tracking-[0.2em] transition-all">Source Lexicon (English)</span>
                    <button id="clear-btn" class="text-slate-400 hover:text-red-500 transition-colors text-xs font-bold uppercase tracking-widest">Purge Text</button>
                </div>
                <textarea 
                    id="input-text" 
                    class="flex-1 w-full bg-transparent border-none focus:ring-0 p-8 text-xl resize-none placeholder-slate-300 outline-none text-slate-800 leading-relaxed custom-scroll"
                    placeholder="Inscribe your discourse for linguistic transposition, twin..."
                    spellcheck="false"
                ></textarea>
            </div>

            <div class="flex-1 flex flex-col bg-white/80 relative">
                <div class="px-8 py-5 flex justify-between items-center bg-white/50">
                    <span id="output-label" class="text-sm font-extrabold text-amber-700 uppercase tracking-[0.2em] transition-all">Target Lexicon (Pos-Sha)</span>
                    <div class="flex gap-2">
                        <span class="h-3 w-3 rounded-full bg-red-500 shadow-inner"></span>
                        <span class="h-3 w-3 rounded-full bg-amber-500 shadow-inner"></span>
                        <span class="h-3 w-3 rounded-full bg-green-500 shadow-inner"></span>
                    </div>
                </div>
                <textarea 
                    id="output-text" 
                    readonly
                    class="flex-1 w-full bg-transparent border-none focus:ring-0 p-8 text-xl resize-none outline-none text-slate-900 font-ancient font-semibold leading-relaxed custom-scroll"
                    placeholder="Awaiting Transposition..."
                ></textarea>
                
                <div class="absolute bottom-8 right-8">
                    <button id="copy-btn" 
                            title="Commit Transposed Text to Clipboard"
                            class="group flex items-center gap-2 bg-slate-900 hover:bg-slate-700 text-white px-6 py-3 rounded-full transition-all duration-200 hover:shadow-xl active:scale-90">
                        <span class="text-sm font-extrabold tracking-wider">Commit to Clipboard</span>
                        <svg class="w-5 h-5 text-amber-400 group-hover:rotate-12 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                    </button>
                </div>
            </div>
        </div>

        <div id="lexicon-compendium" class="grid md:grid-cols-3 gap-8 scroll-mt-24" style="animation-delay: 0.3s;">
            
            <div class="glass-card rounded-3xl p-8 md:col-span-1 flex flex-col justify-center shadow-lg">
                <h3 class="font-ancient font-bold text-xl text-slate-800 mb-2">Lexeme Synthesis Engine ðŸ”¬</h3>
                <p class="text-xs text-slate-500 mb-5 tracking-wide">Generate **neologisms** and **conjugations** for the Pos-Sha lexicon.</p>
                
                <div class="space-y-4">
                    <input type="text" id="forge-input" placeholder="Semantic Root (e.g. Educate)" class="w-full bg-slate-100 border-none rounded-xl px-5 py-2.5 text-sm focus:ring-4 focus:ring-amber-400 focus:ring-opacity-50 outline-none transition-shadow duration-300">
                    <div class="relative">
                        <select id="forge-type" class="w-full appearance-none bg-slate-100 border-none rounded-xl px-5 py-2.5 text-sm focus:ring-4 focus:ring-amber-400 focus:ring-opacity-50 outline-none text-slate-700 transition-shadow cursor-pointer">
                            <option value="noun">Substantive [-iz] (Noun)</option>
                            <option value="verb">Dynamic [-ek] (Verb)</option>
                            <option value="adj">Qualitative [-vum] (Adjective/Adverb)</option>
                            <option value="other">Particle [-ril] (Pronoun/Conjunction)</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                            <svg class="fill-current h-4 w-4" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                        </div>
                    </div>
                    <button id="forge-btn" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-extrabold py-3 rounded-xl transition-colors text-sm shadow-xl hover:shadow-2xl active:scale-95 duration-200">Synthesize Lexeme</button>
                    <div id="forge-result" class="text-center hidden pt-3 bg-amber-50/50 rounded-xl p-2">
                        <span class="text-xs text-slate-500 block mb-1">Generated Pos-Sha Term</span>
                        <span class="font-ancient text-xl text-slate-900 animate-pulse" id="forge-output"></span>
                    </div>
                </div>
            </div>

            <div class="glass-card rounded-3xl p-8 md:col-span-2 overflow-hidden flex flex-col h-[400px] md:h-auto shadow-lg">
                <div class="flex justify-between items-baseline mb-5 border-b-2 border-slate-200 pb-3">
                    <h3 class="font-ancient font-extrabold text-xl text-slate-800">The Comprehensive Pos-Sha Lexicon</h3>
                    <span class="text-xs font-extrabold bg-slate-200 text-slate-600 px-3 py-1 rounded-full shadow-inner">Unmapped Term $\rightarrow$ **pos...ti**</span>
                </div>
                
                <div class="overflow-y-auto custom-scroll pr-4 flex-1">
                    <div class="grid grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-3 text-base" id="vocab-list">
                        </div>
                </div>
            </div>
        </div>
    </main>

    <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" id="back-to-top" 
            title="Return to the Summit"
            class="back-to-top fixed bottom-10 right-10 bg-slate-900 text-amber-400 p-4 rounded-full shadow-2xl hover:scale-120 transition-transform duration-500 z-40">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
    </button>

    <div id="toast" class="fixed top-8 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-8 py-3.5 rounded-full shadow-2xl flex items-center gap-3 transition-all duration-400 ease-out opacity-0 translate-y-[-30px] z-50">
        <span class="text-amber-400 text-xl">âœ…</span>
        <span class="font-semibold text-sm tracking-wider">Transposition **Successfully** Committed to Clipboard!</span>
    </div>

    <script>
        // --- LEXICAL DATA COMPENDIUM ---
        // NEW SUFFIXES: -iz (Substantive/Noun), -ek (Dynamic/Verb), -vum (Qualitative/Adjective/Adverb), -ril (Particle/Pronoun/Conjunction)

        const lexicon = {
            // --- PARTICLES & DETERMINERS (-ril) ---
            "i": "egoril", "me": "egoril", "my": "egoril", "mine": "egoril",
            "you": "turil", "your": "turil", "yours": "turil",
            "he": "isoril", "him": "isoril", "his": "isoril",
            "she": "isoril", "her": "isoril", "hers": "isoril",
            "it": "isoril", "its": "isoril",
            "we": "nosril", "us": "nosril", "our": "nosril", "ours": "nosril",
            "they": "illiril", "them": "illiril", "their": "illiril", "theirs": "illiril",
            "this": "hicril", "that": "illeril", "these": "hicril", "those": "illeril",
            "who": "quisril", "what": "quidril", "where": "ubiril", "why": "quaril",
            "the": "toril", "a": "aril", "an": "aril",
            "some": "alquiril", "many": "multiril", "much": "multiril",
            "one": "unoril", "two": "duoril", "three": "tresril", "four": "quadril", "five": "quinril",
            "every": "omneril", "never": "numquamril", "always": "semperril",
            "down": "subril", "up": "supraeril",

            // --- SUBSTANTIVES (NOUNS: -iz) ---
            "friend": "zeniz", "homie": "zeniz", "buddy": "zeniz", "twin": "zeniz", "ally": "zeniz",
            "cat": "felinuz", "kitty": "felinuz",
            "dog": "caniz", "dawg": "caniz", "pup": "caniz",
            "house": "domiiz", "home": "domiiz", "residence": "domiiz", "structure": "aedifiz",
            "sun": "**solaxiz**", // Changed from solariz
            "star": "**astriz**", // Changed from stelliz
            "moon": "**kyuiz**", 
            "man": "hominiz", "individual": "personiz",
            "boy": "paiz", "son": "paiz", "child": "infantiz",
            "food": "victualiz", "sustenance": "alimentiz", "meal": "shiniz",
            "river": "**akviz**", // Changed from riviz
            "ocean": "**mereziz**", // Changed from mariz
            "sea": "mereziz", 
            "lake": "**lacuz**", // Changed from laciz
            "tree": "**arboriz**", // Changed from arbiz
            "water": "**hidruz**", // Changed from hidriz
            "air": "**aeruz**", // Changed from aeriz
            "fire": "**blazuz**", 
            "earth": "**terruz**", // Changed from terriz
            "time": "**chronoz**", // Changed from chroniz
            "duration": "**tempiz**", // Changed from tempusiz
            "day": "**loriz**", // Changed from luriz
            "night": "**noxuz**", // Changed from noxiz
            "life": "**vivuz**", // Changed from viviz
            "death": "**mortiz**", // Changed from moriz
            "name": "**nominiz**", // Changed from nomiz
            "place": "topiz", "location": "lociz",
            "work": "**laboriz**", // Changed from labiz
            "labor": "ergiz", 
            "money": "**pecuniz**", // Kept, but added "cash" alternate for flow
            "cash": "numiz",
            "city": "**polizuz**", // Changed from polisiz
            "metropolis": "urbiz", 
            "problem": "**malumiz**", // Changed from maliz
            "difficulty": "dilemmiz",
            "mind": "**mentuz**", // Changed from mentiz
            "intellect": "psykiz", 
            "heart": "**karduz**", // Changed from kardiz
            "emotion": "affectiz", 
            "body": "**somuz**", // Changed from somiz
            "magic": "**arcaniz**", // Changed from arcanaiz
            "god": "deiz", 
            "deity": "**theouz**", // Changed from theosiz
            "woman": "gyniz", "girl": "gyniz", "lady": "gyniz", 
            "love": "**amoriz**", // Changed from amiiz
            "affection": "amoriz", 
            "devotion": "**pietuz**", // Changed from pietiz
            "queen": "**reguz**", // Changed from regiz
            "ruler": "souvereniz", 
            "idea": "**conceptuz**", // Changed from conceptiz
            "thought": "**cogituz**", // Changed from cogitiz
            "system": "systemiz", 
            "theory": "**theorizuz**", // Changed from theoriz
            "knowledge": "**scientizuz**", // Changed from scientiz
            "world": "**globoriz**",

            // --- DYNAMICS (VERBS: -ek) ---
            "is": "**estek**", "am": "**estek**", "are": "**estek**", "be": "**estek**", "was": "**estek**", "were": "**estek**", "to be": "**estek**",
            "eat": "**comedek**", // Kept Latin root, as it is a less obvious one
            "ingest": "fodrek", 
            "to eat": "comedek",
            "see": "**viderek**", // Changed from vidrek
            "observe": "**spectek**", // Kept Latin root
            "to see": "viderek",
            "go": "**vadimek**", // Kept Latin root
            "proceed": "badek", 
            "to go": "vadimek",
            "like": "**dilegek**", // Kept Latin root
            "cherish": "filtek", 
            "to like": "dilegek",
            "speak": "**loquorvek**", // Kept Latin root
            "articulate": "legrek", 
            "to speak": "loquorvek",
            "jump": "**saltarex**", // Kept Latin root
            "leap": "saltek", 
            "to jump": "saltarex",
            "run": "**kurrek**", // Kept Latin root
            "flee": "fugiek", 
            "to run": "kurrek",
            "fight": "**pugnarex**", // Kept Latin root
            "struggle": "pugnek", 
            "to fight": "pugnarex",
            "do": "**faciek**", 
            "execute": "facyek", 
            "make": "faciek",
            "come": "**venirex**", 
            "arrive": "venyek",
            "take": "**capiek**", 
            "acquire": "capek",
            "give": "**donarex**", 
            "bestow": "dontek",
            "walk": "**ambulek**", 
            "stroll": "vadimek", 
            "sleep": "**hypnek**", 
            "rest": "**pausiek**",
            "know": "**cognoscek**", 
            "comprehend": "skiyek", 
            "understand": "**intellegiek**",
            "want": "**voluptek**", 
            "desire": "volek", 
            "need": "**necessiek**",
            "help": "**juvlek**", 
            "assist": "**auxiliek**",
            "think": "**cogitatek**", 
            "reflect": "cogtek",
            "play": "ludek", 
            "engage": "ludek",
            "learn": "**discerek**", 
            "teach": "**docek**",

            // --- QUALITATIVES (ADJECTIVES & ADVERBS: -vum) ---
            "big": "**maxvum**", // Changed from maximalvum
            "huge": "megavum", 
            "vast": "**grandivuz**", // Changed from grandivum
            "small": "**minivuz**", // Changed from minimalvum
            "tiny": "mikrovum", 
            "minute": "**exiguuz**", // Changed from exiguuvum
            "good": "**bonovuz**", // Changed from bonovum
            "excellent": "gudovum", 
            "well": "**benignivuz**", // Changed from benignuvum
            "bad": "**maluvuz**", // Changed from malumvum
            "terrible": "kaklovum", 
            "poorly": "**deterivuz**", // Changed from deteriusvum
            "happy": "**felicivuz**", // Changed from felicivum
            "joyful": "hapivum", 
            "merrily": "**laetavuz**", // Changed from laetavum
            "sad": "**lugetvuz**", // Changed from lugetvum
            "sorrowful": "**tristivuz**", // Changed from tristivum
            "fast": "**velocivuz**", // Changed from velocivum
            "quickly": "tashovum", 
            "rapidly": "**celerivuz**", // Changed from celerivum
            "slow": "**lentuvuz**", // Changed from lentuvum
            "slowly": "bradovum", 
            "gradually": "**tardivuz**", // Changed from tardivuvum
            "old": "**vetustivuz**", // Changed from vetustuvum
            "ancient": "**antiquuz**", // Changed from antiquuvum
            "new": "neovum", 
            "modern": "**novelluz**", // Changed from novelluvum
            "hot": "**thermivuz**", // Changed from thermivuvum
            "cold": "kryovum", 
            "frigid": "**glacialuz**", // Changed from glacialuvum
            "full": "**plenitudvuz**", // Changed from plenitudvum
            "empty": "**vacuuz**", // Changed from vacuuvum
            "strong": "**potentivuz**", // Changed from potentiavum
            "mighty": "potenvum", 
            "weak": "**impotentvuz**", // Changed from impotentvum
            "feeble": "impovum",
            "beautiful": "**bellivuz**", // Changed from belluvum
            "aesthetivuvum": "**aesthetivuz**", // Changed from aesthetivuvum
            "ugly": "**turpivuz**", // Changed from turpivuvum
            "deformed": "**deformuvuz**", // Changed from deformuvum
            "true": "**veritivuz**", // Changed from verituvum
            "false": "**falsivuz**", // Changed from falsuvum

            // --- CONJUNCTIONS & PREPOSITIONS (-ril) ---
            "no": "**negativeril**", 
            "not": "noril", 
            "nah": "noril",
            "yes": "**affirmatiril**", 
            "yeah": "yaril", 
            "yep": "yaril",
            "all": "pantaril", 
            "everything": "**omnesril**",
            "and": "etril", 
            "moreover": "enril", 
            "but": "sedril", 
            "however": "**autemril**", 
            "or": "velril",
            "for": "**proproril**", 
            "on": "**superril**", 
            "in": "inril", 
            "within": "**intraeril**", 
            "with": "cumril",
            "of": "deril", 
            "from": "**exril**", 
            "to": "adril", 
            "toward": "**versusril**",
            "because": "**quiaril**", 
            "since": "**quoniamril**", 
            "if": "siril", 
            "when": "**quandoril**",
            "how": "**quomoril**",

            // --- GREETINGS & SLANG ---
            "hello": "**salutekril**", 
            "hi": "saluvum", 
            "yo": "saluvum",
            "bye": "**valedixeril**", 
            "peace": "paxril", 
            "farewell": "valeril",
            "let's": "nosril", 
            "dope": "**magnificuvuz**", // Changed from magnificuvum
            "lit": "**fulgensvuz**" // Changed from fulgensvum
        };

        const phrases = {
            "my bad": "egoril maluvuz", // Changed based on new word
            "let's go": "nosril vadimek",
            "it's all good": "isoril pantaril bonovuz", // Changed based on new word
            "all good": "pantaril bonovuz", // Changed based on new word
            "i love you": "egoril dilegek turil",
            "i know": "egoril cognoscek",
            "peace out": "valeril paxril",
            "what's up": "quidril supraeril estek"
        };

        // Pronoun lookup table for Pos-Sha to English translation
        const pronounCases = {
            "egoril": { subject: "I", object: "me", possessive: "my" },
            "turil": { subject: "you", object: "you", possessive: "your" },
            "isoril": { subject: "he/she/it", object: "him/her/it", possessive: "his/her/its" }, 
            "nosril": { subject: "we", object: "us", possessive: "our" },
            "illiril": { subject: "they", object: "them", possessive: "their" },
            "toril": { subject: "the", object: "the", possessive: "the" },
            "aril": { subject: "a", object: "a", possessive: "a" },
            "hicril": { subject: "this/these", object: "this/these", possessive: "this/these" },
            "illeril": { subject: "that/those", object: "that/those", possessive: "that/those" }
        };

        // List of Substantives (Nouns ending in -iz) that can be possessed
        const substantiveWords = Object.keys(lexicon).filter(key => lexicon[key].endsWith('iz') || key.endsWith('uz')).map(key => lexicon[key]);
        // Re-calculate list to include the new -uz endings

        // List of Dynamics (Verbs ending in -ek)
        const dynamicWords = Object.keys(lexicon).filter(key => lexicon[key].endsWith('ek') || key.endsWith('ex')).map(key => lexicon[key]);
        // Re-calculate list to include the new -ex endings
        
        // Generate Reverse Glossary (Pos-Sha -> Primary English Root)
        const posShaGlossary = {};
        for (const [eng, pos] of Object.entries(lexicon)) {
            if (!pronounCases[pos]) {
                const currentRoot = posShaGlossary[pos];
                // Prioritize shorter, common words as the primary root
                if (!currentRoot || eng.length < currentRoot.length || eng === 'friend' || eng === 'dog' || eng === 'love') {
                    posShaGlossary[pos] = eng;
                }
            }
        }
        
        // Explicitly set key roots for clarity in the reverse map
        posShaGlossary["gyniz"] = "woman"; 
        posShaGlossary["paiz"] = "boy";
        posShaGlossary["amoriz"] = "love"; // Changed
        posShaGlossary["reguz"] = "queen"; // Changed
        posShaGlossary["cognoscek"] = "know"; 
        posShaGlossary["faciek"] = "do"; 
        posShaGlossary["felinuz"] = "cat";
        posShaGlossary["caniz"] = "dog";
        posShaGlossary["kyuiz"] = "moon"; 
        posShaGlossary["blazuz"] = "fire"; 
        posShaGlossary["solaxiz"] = "sun"; // New
        posShaGlossary["astriz"] = "star"; // New
        posShaGlossary["hidruz"] = "water"; // New
        posShaGlossary["terruz"] = "earth"; // New
        posShaGlossary["chronoz"] = "time"; // New
        posShaGlossary["loriz"] = "day"; // New
        posShaGlossary["noxuz"] = "night"; // New
        posShaGlossary["vivuz"] = "life"; // New


        // --- DOM REFERENCE INTERFACE ---
        const uiElements = {
            main: document.getElementById('input-text'),
            output: document.getElementById('output-text'),
            clear: document.getElementById('clear-btn'),
            copy: document.getElementById('copy-btn'),
            swapBtn: document.getElementById('swap-mode-btn'),
            swapIcon: document.getElementById('swap-icon'),
            inputLabel: document.getElementById('input-label'),
            outputLabel: document.getElementById('output-label'),
            forgeRoot: document.getElementById('forge-input'),
            forgeType: document.getElementById('forge-type'),
            forgeBtn: document.getElementById('forge-btn'),
            forgeRes: document.getElementById('forge-result'),
            forgeOut: document.getElementById('forge-output'),
            vocabList: document.getElementById('vocab-list'),
            backToTop: document.getElementById('back-to-top')
        };

        // --- APPLICATION STATE ---
        let isEnglishToPosSha = true;

        // --- INIT LEXICON UI ---
        // Curated set for the UI compendium
        const compendiumSet = {
            "I/Me/My": "egoril", "You/Your": "turil", "They/Them": "illiril", "We/Us": "nosril",
            "The/A": "toril/aril", "Friend": "zeniz", "Dog": "caniz", "House": "domiiz",
            "Love (new)": "amoriz", "Fire (new)": "blazuz", "Moon (new)": "kyuiz", "Time (new)": "chronoz", "Knowledge": "scientizuz",
            "To Be": "estek", "To Eat": "comedek", "To Go": "vadimek", "To Know": "cognoscek",
            "To Think/Cogitate": "cogitatek", "Big (new)": "maxvum", "Small (new)": "minivuz", "Good (new)": "bonovuz",
            "Bad (new)": "maluvuz", "Happy (new)": "felicivuz", "Fast (new)": "velocivuz", "Slow (new)": "lentuvuz",
            "No/Not": "negativeril", "Yes/Affirm": "affirmatiril", "And": "etril", "With/Cum": "cumril",
            "Why?": "quaril", "Always": "semperril"
        };

        // Populate the Compendium Display
        uiElements.vocabList.innerHTML = '';
        for (const [eng, eos] of Object.entries(compendiumSet)) {
            const div = document.createElement('div');
            div.className = "flex justify-between border-b border-slate-100 py-2 hover:bg-slate-50 px-2 rounded-lg transition-colors";
            div.innerHTML = `<span class="text-slate-600 font-medium">${eng}</span> <span class="font-semibold text-amber-700 font-ancient">${eos}</span>`;
            uiElements.vocabList.appendChild(div);
        }

        // --- LINGUISTIC TRANSPOSITION ENGINES ---
        
        // 1. Source (English) -> Target (Pos-Sha) 
        function transposeToPosSha(text) {
            if (!text.trim()) return "";
            let processedText = text.toLowerCase();
            
            // Phase 1: Multi-word Phrase Mapping (Handle idioms and set phrases first)
            for (const [phrase, translation] of Object.entries(phrases)) {
                // Use a more robust boundary check
                processedText = processedText.replace(new RegExp(`\\b${phrase}\\b`, 'gi'), translation);
            }

            // Phase 2: Atomic Tokenization (Splitting words, spaces, and punctuation)
            const tokens = processedText.match(/(\w+['â€™]?\w*|[^\w\s]|\s+)/g) || [];
            
            let translatedTokens = tokens.map(token => {
                if (/^[\s\p{P}]+$/u.test(token)) return token; // Preserve only spaces and punctuation
                
                const cleanWord = token.toLowerCase();
                
                // Check lexicon for exact match 
                if (lexicon[cleanWord]) return lexicon[cleanWord];
                
                // Handle simple plurals (e.g., cats -> cat)
                if (cleanWord.endsWith('s')) {
                    const singular = cleanWord.slice(0, -1);
                    if (lexicon[singular]) return lexicon[singular];
                }
                
                // Phase 3: Default Neologism Protocol (Unknown word wrapper)
                return `pos${cleanWord}ti`;
            });

            // Phase 4: Case Restoration
            return formatCase(translatedTokens.join(''));
        }

        // 2. Target (Pos-Sha) -> Source (English) (Contextual interpretation)
        function transposeToEnglish(text) {
            if (!text.trim()) return "";
            
            const wordsOnly = text.match(/\b\w+\b/g) || [];
            const rawTokens = text.match(/(\w+|[^\w\s]|\s+)/g) || [];
            let translatedTokens = [];

            const findWordIndexInWordsOnly = (wordOnlyIndex, step) => {
                let index = wordOnlyIndex + step;
                return (index >= 0 && index < wordsOnly.length) ? index : null;
            };

            let wordOnlyIndex = 0; 

            for (let i = 0; i < rawTokens.length; i++) {
                let token = rawTokens[i];
                let cleanWord = token.toLowerCase();

                if (/\w+/.test(token)) {
                    
                    // --- 1. Interpretation of Particles (Pronouns/Possessives) ---
                    if (pronounCases[cleanWord]) {
                        let pronounData = pronounCases[cleanWord];
                        let englishWord = pronounData.subject; 

                        const nextWordOnlyIndex = findWordIndexInWordsOnly(wordOnlyIndex, 1);
                        const prevWordOnlyIndex = findWordIndexInWordsOnly(wordOnlyIndex, -1);
                        
                        const nextWord = nextWordOnlyIndex !== null ? wordsOnly[nextWordOnlyIndex].toLowerCase() : null;
                        const prevWord = prevWordOnlyIndex !== null ? wordsOnly[prevWordOnlyIndex].toLowerCase() : null;
                        
                        // Rule 1: Possessive Attribution (followed by a substantive: ending in -iz or -uz)
                        if (nextWord && substantiveWords.includes(nextWord)) {
                            englishWord = pronounData.possessive;
                        
                        // Rule 2: Objective Case (preceded by a dynamic/verb: ending in -ek or -ex, and not the sentence initial word)
                        } else if (prevWord && dynamicWords.includes(prevWord) && cleanWord !== wordsOnly[0].toLowerCase()) {
                            englishWord = pronounData.object;
                        } 
                        
                        translatedTokens.push(englishWord);
                        wordOnlyIndex++; 
                        continue;
                    
                    // --- 2. Lexical Lookup (Substantives, Dynamics, Qualitatives, other Particles) ---
                    } else if (posShaGlossary[cleanWord]) {
                        translatedTokens.push(posShaGlossary[cleanWord]);
                        wordOnlyIndex++;
                        continue;
                    }

                    // --- 3. Pos-ti Deconstruction (Reversing the neologism protocol) ---
                    const posTiMatch = cleanWord.match(/^pos(.+)ti$/);
                    if (posTiMatch) {
                        translatedTokens.push(posTiMatch[1]); // Return the inner word
                        wordOnlyIndex++;
                        continue;
                    }

                    // If unmapped, maintain the original token
                    translatedTokens.push(token);
                    wordOnlyIndex++;
                
                } else {
                    // 4. Preserve Non-Word Tokens (Punctuation, spacing)
                    translatedTokens.push(token);
                }
            }

            // Phase 4: Case Restoration
            return formatCase(translatedTokens.join(''));
        }

        // Helper for basic sentence case (Capitalizes first letter and letters after sentence-ending punctuation)
        function formatCase(str) {
            return str.replace(/(?:^|[.!?]\s+)([a-z])/g, (c) => c.toUpperCase());
        }

        // Master Function for Orchestrating Transposition
        function initiateTransposition() {
            const text = uiElements.main.value;
            if (isEnglishToPosSha) {
                uiElements.output.value = transposeToPosSha(text);
            } else {
                uiElements.output.value = transposeToEnglish(text);
            }
        }

        // --- EVENT HANDLERS ---
        uiElements.main.addEventListener('input', initiateTransposition);

        uiElements.clear.addEventListener('click', () => {
            uiElements.main.value = '';
            uiElements.output.value = '';
            uiElements.main.focus();
        });

        uiElements.swapBtn.addEventListener('click', () => {
            isEnglishToPosSha = !isEnglishToPosSha;
            
            uiElements.swapIcon.classList.toggle('rotate-180-smooth');
            
            if (isEnglishToPosSha) {
                uiElements.inputLabel.textContent = "Source Lexicon (English)";
                uiElements.inputLabel.className = "text-sm font-extrabold text-slate-500 uppercase tracking-[0.2em] transition-all";
                uiElements.outputLabel.textContent = "Target Lexicon (Pos-Sha)";
                uiElements.outputLabel.className = "text-sm font-extrabold text-amber-700 uppercase tracking-[0.2em] transition-all";
                uiElements.main.placeholder = "Inscribe your discourse for linguistic transposition, twin...";
            } else {
                uiElements.inputLabel.textContent = "Source Lexicon (Pos-Sha)";
                uiElements.inputLabel.className = "text-sm font-extrabold text-amber-700 uppercase tracking-[0.2em] transition-all";
                uiElements.outputLabel.textContent = "Target Lexicon (English)";
                uiElements.outputLabel.className = "text-sm font-extrabold text-slate-500 uppercase tracking-[0.2em] transition-all";
                uiElements.main.placeholder = "Inscribe Pos-Sha terms (e.g. egoril dilegek turil)...";
            }

            // Swap text content
            const currentIn = uiElements.main.value;
            const currentOut = uiElements.output.value;
            
            uiElements.main.value = currentOut;
            uiElements.output.value = currentIn;
            
            initiateTransposition(); // Re-translate the swapped content
        });

        uiElements.copy.addEventListener('click', () => {
            if (!uiElements.output.value) return;
            uiElements.output.select();
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(uiElements.output.value);
            } else {
                document.execCommand('copy'); // Fallback for older browsers
            }

            // Display toast notification
            const toast = document.getElementById('toast');
            toast.classList.remove('opacity-0', 'translate-y-[-30px]');
            setTimeout(() => toast.classList.add('opacity-0', 'translate-y-[-30px]'), 2500);
        });

        uiElements.forgeBtn.addEventListener('click', () => {
            const root = uiElements.forgeRoot.value.trim().toLowerCase();
            if (!root) return;
            let suffix = "";
            switch(uiElements.forgeType.value) {
                case 'noun': suffix = "iz"; break;
                case 'verb': suffix = "ek"; break;
                case 'adj': suffix = "vum"; break; 
                case 'other': suffix = "ril"; break;
            }
            // Simple sanitization to create a clean root
            const cleanRoot = root.replace(/[^a-z0-9]/g, ''); 
            
            uiElements.forgeOut.textContent = cleanRoot + suffix;
            uiElements.forgeRes.classList.remove('hidden');
        });

        // Visibility toggle for the scroll-to-top button
        window.addEventListener('scroll', () => {
            if (window.scrollY > 400) uiElements.backToTop.classList.add('visible');
            else uiElements.backToTop.classList.remove('visible');
        });

        window.addEventListener('load', () => {
            uiElements.main.focus();
        });

    </script>
</body>
</html>
