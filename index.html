<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pos-Sha</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Manrope:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8fafc;
            --accent: #d97706; /* Amber 600 */
        }
        
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Manrope', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 32px 32px;
            color: #1e293b;
        }
        .font-ancient { font-family: 'Cinzel', serif; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.05);
        }
        .input-area { transition: all 0.3s ease; }
        .input-area:focus-within {
            background: white;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02); 
        }
        
        /* Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade { animation: fadeIn 0.5s ease-out forwards; }

        .back-to-top {
            opacity: 0; transform: translateY(20px); pointer-events: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .back-to-top.visible { opacity: 1; transform: translateY(0); pointer-events: all; }

        /* Swap Button Animation */
        .rotate-180-smooth { transform: rotate(180deg); }
    </style>
</head>
<body id="top" class="min-h-screen flex flex-col items-center py-12 px-4 selection:bg-amber-100 selection:text-amber-900 relative">

    <header class="text-center mb-10 animate-fade w-full max-w-4xl flex flex-col md:flex-row justify-between items-center gap-4 md:gap-0">
        <div class="text-center md:text-left">
            <div class="inline-flex items-center justify-center w-12 h-12 bg-slate-900 text-amber-400 rounded-xl shadow-lg mb-2 text-2xl">
                üèõÔ∏è
            </div>
            <h1 class="text-3xl md:text-4xl font-ancient font-bold text-slate-900 tracking-tight">Pos-Sha</h1>
            <p class="text-slate-500 text-xs font-bold tracking-widest uppercase">The Posti, Sharron Language Project. Now with Mega-Sha Vocab!</p>
        </div>
        
        <button onclick="document.getElementById('vocab-section').scrollIntoView({behavior: 'smooth'})" 
                class="group flex items-center gap-2 px-5 py-2 bg-white border border-slate-200 rounded-full shadow-sm hover:shadow-md hover:border-amber-200 transition-all">
            <span class="text-xs font-bold text-slate-600 group-hover:text-amber-600 uppercase tracking-wide">Vocab List</span>
            <svg class="w-4 h-4 text-slate-400 group-hover:text-amber-500 transform group-hover:translate-y-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </button>
    </header>

    <main class="w-full max-w-4xl space-y-8 animate-fade" style="animation-delay: 0.1s;">
        
        <div class="flex justify-center items-center mb-[-20px] z-10 relative">
            <button id="swap-mode-btn" class="bg-slate-900 hover:bg-amber-500 text-amber-400 hover:text-white p-3 rounded-full shadow-lg transition-all hover:scale-110 active:rotate-180 duration-300 group">
                <svg class="w-5 h-5 transition-transform duration-500" id="swap-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>
            </button>
        </div>

        <div class="glass-card rounded-3xl overflow-hidden shadow-xl flex flex-col md:flex-row min-h-[400px]">
            
            <div class="flex-1 flex flex-col border-b md:border-b-0 md:border-r border-slate-100 input-area bg-slate-50/50">
                <div class="px-6 py-4 flex justify-between items-center">
                    <span id="input-label" class="text-xs font-bold text-slate-400 uppercase tracking-widest transition-all">English</span>
                    <button id="clear-btn" class="text-slate-300 hover:text-red-400 transition-colors text-xs font-bold uppercase">Clear</button>
                </div>
                <textarea 
                    id="input-text" 
                    class="flex-1 w-full bg-transparent border-none focus:ring-0 p-6 text-xl resize-none placeholder-slate-300 outline-none text-slate-700 leading-relaxed"
                    placeholder="Type your thoughts here, twin..."
                    spellcheck="false"
                ></textarea>
            </div>

            <div class="flex-1 flex flex-col bg-white/60 relative">
                <div class="px-6 py-4 flex justify-between items-center">
                    <span id="output-label" class="text-xs font-bold text-amber-600 uppercase tracking-widest transition-all">Pos-Sha</span>
                    <div class="flex gap-2">
                        <span class="h-2 w-2 rounded-full bg-red-400"></span>
                        <span class="h-2 w-2 rounded-full bg-amber-400"></span>
                        <span class="h-2 w-2 rounded-full bg-green-400"></span>
                    </div>
                </div>
                <textarea 
                    id="output-text" 
                    readonly
                    class="flex-1 w-full bg-transparent border-none focus:ring-0 p-6 text-xl resize-none outline-none text-slate-800 font-ancient font-medium leading-relaxed"
                    placeholder="..."
                ></textarea>
                
                <div class="absolute bottom-6 right-6">
                    <button id="copy-btn" class="group flex items-center gap-2 bg-slate-900 hover:bg-slate-800 text-white px-5 py-2.5 rounded-full transition-all hover:shadow-lg active:scale-95">
                        <span class="text-sm font-bold">Copy</span>
                        <svg class="w-4 h-4 text-amber-400 group-hover:rotate-12 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                    </button>
                </div>
            </div>
        </div>

        <div id="vocab-section" class="grid md:grid-cols-3 gap-6 scroll-mt-6" style="animation-delay: 0.2s;">
            
            <div class="glass-card rounded-3xl p-6 md:col-span-1 flex flex-col justify-center">
                <h3 class="font-ancient font-bold text-lg text-slate-800 mb-1">Word Forger ‚öíÔ∏è</h3>
                <p class="text-xs text-slate-400 mb-4">Create custom Pos-Sha words.</p>
                
                <div class="space-y-3">
                    <input type="text" id="forge-input" placeholder="Root (e.g. Teach)" class="w-full bg-slate-100 border-none rounded-xl px-4 py-2 text-sm focus:ring-2 focus:ring-amber-400 outline-none transition-shadow">
                    <div class="relative">
                        <select id="forge-type" class="w-full appearance-none bg-slate-100 border-none rounded-xl px-4 py-2 text-sm focus:ring-2 focus:ring-amber-400 outline-none text-slate-600 transition-shadow cursor-pointer">
                            <option value="noun">Noun [-iz]</option>
                            <option value="verb">Verb [-ek]</option>
                            <option value="adj">Adjective/Adverb [-vum]</option>
                            <option value="other">Other [-ril]</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                            <svg class="fill-current h-4 w-4" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                        </div>
                    </div>
                    <button id="forge-btn" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 rounded-xl transition-colors text-sm shadow-md hover:shadow-lg active:scale-95">Forge It</button>
                    <div id="forge-result" class="text-center hidden pt-2">
                        <span class="font-ancient text-lg text-slate-800 animate-pulse" id="forge-output"></span>
                    </div>
                </div>
            </div>

            <div class="glass-card rounded-3xl p-6 md:col-span-2 overflow-hidden flex flex-col h-64 md:h-auto">
                <div class="flex justify-between items-baseline mb-4 border-b border-slate-100 pb-2">
                    <h3 class="font-ancient font-bold text-lg text-slate-800">The Golden Rules</h3>
                    <span class="text-xs font-bold bg-slate-100 text-slate-500 px-2 py-1 rounded">Unknown = pos...ti</span>
                </div>
                
                <div class="overflow-y-auto custom-scroll pr-2">
                    <div class="grid grid-cols-2 gap-2 text-sm" id="vocab-list">
                        </div>
                </div>
            </div>
        </div>
    </main>

    <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" id="back-to-top" class="back-to-top fixed bottom-8 right-8 bg-slate-900 text-amber-400 p-3 rounded-full shadow-xl hover:scale-110 transition-transform z-40">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
    </button>

    <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 transition-all duration-300 opacity-0 translate-y-[-20px] z-50">
        <span class="text-amber-400 text-lg">‚úì</span>
        <span class="font-medium text-sm">Copied to clipboard</span>
    </div>

    <script>
        // --- DATA ---
        // NEW SUFFIXES: -iz (Noun), -ek (Verb), -vum (Adjective/Adverb), -ril (Pronoun/Particle)

        const dictionary = {
            // --- PRONOUNS & ARTICLES (-ril) ---
            "i": "egoril", "me": "egoril", "my": "egoril", "mine": "egoril",
            "you": "turil", "your": "turil", "yours": "turil",
            "he": "isoril", "him": "isoril", "his": "isoril",
            "she": "isoril", "her": "isoril", "hers": "isoril",
            "it": "isoril", "its": "isoril",
            "we": "nosril", "us": "nosril", "our": "nosril", "ours": "nosril",
            "they": "illiril", "them": "illiril", "their": "illiril", "theirs": "illiril",
            "this": "hicril", "that": "illeril", "these": "hicril", "those": "illeril",
            "who": "quisril", "what": "quidril", "where": "ubiril",
            "the": "toril", "a": "aril", "an": "aril",
            "some": "alquiril", "many": "multiril", "much": "multiril",
            "one": "unoril", "two": "duoril", "three": "tresril",

            // --- COMMON NOUNS (-iz) ---
            "friend": "zeniz", "homie": "zeniz", "buddy": "zeniz", "twin": "zeniz",
            "cat": "katiz", "kitty": "katiz",
            "dog": "kryguz", "dawg": "kryguz", "pup": "kryguz",
            "house": "domiiz", "home": "domiiz", "crib": "domiiz", "building": "domiiz",
            "sun": "soliz", "star": "stelliz", "moon": "luniz",
            "man": "hominiz", "dude": "hominiz", "guy": "hominiz",
            "boy": "paiz", "son": "paiz",
            "food": "shiniz", "grub": "shiniz", "meal": "shiniz",
            "river": "riviz", "ocean": "mariz", "sea": "mariz",
            "tree": "arbiz", "water": "hidriz", "air": "aeriz", "fire": "pyriz", "earth": "terriz",
            "time": "tymeriz", "day": "luriz", "night": "noxiz", "life": "viviz",
            "death": "moriz", "name": "nomiz", "place": "topiz",
            "work": "ergiz", "money": "numiz", "cash": "numiz",
            "city": "poliz", "problem": "maliz", "thing": "kosiz",
            "mind": "psykiz", "heart": "kardiz", "body": "somiz",
            "magic": "magiz", "god": "deiz",
            "woman": "gyniz", "girl": "gyniz", "lady": "gyniz", 
            "love": "amiiz", "affection": "amiiz",
            "queen": "regiz", "idea": "conceptiz", "thought": "conceptiz",

            // --- VERBS (INFINITIVE: -ek) ---
            "is": "jestek", "am": "jestek", "are": "jestek", "be": "jestek", "was": "jestek", "were": "jestek",
            "eat": "fodrek", "ate": "fodrek", "to eat": "fodrek",
            "see": "vidrek", "saw": "vidrek", "to see": "vidrek",
            "go": "badek", "went": "badek", "to go": "badek",
            "like": "filtek", "loved": "filtek", "to like": "filtek",
            "speak": "legrek", "say": "legrek", "said": "legrek", "to speak": "legrek",
            "jump": "saltek", "to jump": "saltek",
            "run": "kurrek", "to run": "kurrek",
            "fight": "pugnek", "to fight": "pugnek",
            "do": "facyek", "make": "facyek", "did": "facyek",
            "come": "venyek", "came": "venyek",
            "take": "capek", "took": "capek",
            "give": "dontek", "gave": "dontek",
            "walk": "ambulek", "sleep": "hypnek",
            "know": "skiyek", "understand": "skiyek",
            "want": "volek", "need": "volek",
            "help": "juvlek", "assist": "juvlek",
            "think": "cogtek", "thought": "cogtek",
            "play": "ludek", "game": "ludek",

            // --- ADJECTIVES & ADVERBS (-vum) ---
            "big": "megavum", "huge": "megavum", "large": "megavum",
            "small": "mikrovum", "lil": "mikrovum", "tiny": "mikrovum",
            "good": "gudovum", "great": "gudovum", "well": "gudovum",
            "bad": "kaklovum", "evil": "kaklovum", "poorly": "kaklovum",
            "happy": "hapivum", "joyful": "hapivum",
            "sad": "lugetvum", "unhappy": "lugetvum",
            "fast": "tashovum", "quickly": "tashovum",
            "slow": "bradovum", "slowly": "bradovum",
            "old": "vetuvum", "new": "neovum",
            "hot": "termovum", "cold": "kryovum",
            "full": "plenvum", "empty": "vacuvum",
            "strong": "potenvum", "weak": "impovum",
            "beautiful": "belluvum", "ugly": "turpivum",

            // --- CONJUNCTIONS & PREPOSITIONS (-ril) ---
            "no": "noril", "not": "noril", "nah": "noril",
            "yes": "yaril", "yeah": "yaril", "yep": "yaril",
            "all": "pantaril", "everything": "pantaril",
            "and": "enril", "but": "sedril", "or": "velril",
            "for": "proril", "on": "surril", "in": "inril", "with": "cumril",
            "of": "deril", "from": "deril", "to": "adril",
            "because": "quiaril", "if": "siril", "when": "quandoril",
            "how": "quomoril",

            // --- GREETINGS & SLANG ---
            "hello": "saluvum", "hi": "saluvum", "yo": "saluvum",
            "bye": "valeril", "peace": "paxril",
            "let's": "nosril", 
            "dope": "gudovum", "lit": "gudovum"
        };

        const phrases = {
            "my bad": "egoril kaklovum",
            "let's go": "nosril badek",
            "it's all good": "isoril pantaril gudovum",
            "all good": "pantaril gudovum",
            "i love you": "egoril filtek turil",
            "i know": "egoril skiyek",
            "peace out": "valeril paxril"
        };

        // Pronoun lookup table for Pos-Sha to English translation
        const pronounCases = {
            "egoril": { subject: "I", object: "me", possessive: "my" },
            "turil": { subject: "you", object: "you", possessive: "your" },
            "isoril": { subject: "he", object: "him", possessive: "his" }, 
            "nosril": { subject: "we", object: "us", possessive: "our" },
            "illiril": { subject: "they", object: "them", possessive: "their" },
            "toril": { subject: "the", object: "the", possessive: "the" },
            "aril": { subject: "a", object: "a", possessive: "a" },
            "hicril": { subject: "this", object: "this", possessive: "this" },
            "illeril": { subject: "that", object: "that", possessive: "that" }
        };

        // List of words that are usually followed by a possessive (Nouns ending in -iz)
        const possessiveWords = [
            "zeniz", "katiz", "kryguz", "domiiz", "soliz", "stelliz", "luniz", "hominiz", "paiz",
            "shiniz", "riviz", "mariz", "arbiz", "hidriz", "aeriz", "pyriz", "terriz",
            "tymeriz", "luriz", "noxiz", "viviz", "moriz", "nomiz", "topiz",
            "ergiz", "numiz", "poliz", "maliz", "kosiz",
            "psykiz", "kardiz", "somiz", "magiz", "deiz",
            "gyniz", "amiiz", "regiz", "conceptiz"
        ];

        // List of Verbs (ending in -ek)
        const verbWords = [
            "jestek", "fodrek", "vidrek", "badek", "filtek", "legrek",
            "saltek", "kurrek", "pugnek", "facyek", "venyek", "capek",
            "dontek", "ambulek", "hypnek", "skiyek", "volek", "juvlek",
            "cogtek", "ludek"
        ];
        
        // Generate Reverse Dictionary (Pos-Sha -> English)
        const reverseDictionary = {};
        for (const [eng, pos] of Object.entries(dictionary)) {
            if (!pronounCases[pos]) {
                const currentRoot = reverseDictionary[pos];
                // Simple check for primary word
                if (!currentRoot || eng.length < currentRoot.length) {
                    reverseDictionary[pos] = eng;
                }
            }
        }
        
        // Explicitly set some common or key roots
        reverseDictionary["gyniz"] = "woman"; 
        reverseDictionary["paiz"] = "boy";
        reverseDictionary["amiiz"] = "love";
        reverseDictionary["regiz"] = "queen";
        reverseDictionary["skiyek"] = "know"; 
        reverseDictionary["facyek"] = "do"; 


        // --- DOM ELEMENTS ---
        const inputs = {
            main: document.getElementById('input-text'),
            output: document.getElementById('output-text'),
            clear: document.getElementById('clear-btn'),
            copy: document.getElementById('copy-btn'),
            swapBtn: document.getElementById('swap-mode-btn'),
            swapIcon: document.getElementById('swap-icon'),
            inputLabel: document.getElementById('input-label'),
            outputLabel: document.getElementById('output-label'),
            forgeRoot: document.getElementById('forge-input'),
            forgeType: document.getElementById('forge-type'),
            forgeBtn: document.getElementById('forge-btn'),
            forgeRes: document.getElementById('forge-result'),
            forgeOut: document.getElementById('forge-output'),
            vocabList: document.getElementById('vocab-list'),
            backToTop: document.getElementById('back-to-top')
        };

        // --- STATE ---
        let isEnglishToPosSha = true;

        // --- INIT VOCAB UI ---
        // Expanded starter pack for the UI using the NEW words
        const starterPack = {
            "I/Me/My": "egoril", "You/Your": "turil", "He/She/It": "isoril", "We/Us": "nosril",
            "The/A": "toril/aril", "Friend/Homie": "zeniz", "Dog/Dawg": "kryguz", "House/Home": "domiiz",
            "Love": "amiiz", "Food": "shiniz", "Time": "tymeriz", "To Be": "jestek",
            "To Eat": "fodrek", "To Go": "badek", "To Know": "skiyek", "Big": "megavum",
            "Small": "mikrovum", "Good": "gudovum", "Bad": "kaklovum", "No/Not": "noril", 
            "Yes": "yaril", "Hello": "saluvum", "And": "enril", "With": "cumril"
        };

        // Clear existing list and populate with the expanded starter pack
        inputs.vocabList.innerHTML = '';
        for (const [eng, eos] of Object.entries(starterPack)) {
            const div = document.createElement('div');
            div.className = "flex justify-between border-b border-slate-100 py-1.5 hover:bg-slate-50 px-1 rounded transition-colors";
            div.innerHTML = `<span class="text-slate-500">${eng}</span> <span class="font-medium text-amber-600 font-ancient">${eos}</span>`;
            inputs.vocabList.appendChild(div);
        }

        // --- TRANSLATION ENGINES ---
        
        // 1. Eng -> Pos 
        function translateToPosSha(text) {
            if (!text.trim()) return "";
            let processedText = text.toLowerCase();
            
            // Phrases (Handle multi-word phrases first)
            for (const [phrase, translation] of Object.entries(phrases)) {
                processedText = processedText.replace(new RegExp(`\\b${phrase}\\b`, 'gi'), translation);
            }

            // Tokenize by splitting words, spaces, and punctuation
            const tokens = processedText.match(/(\w+['‚Äô]?\w*|[^\w\s]|\s+)/g) || [];
            
            let translatedTokens = tokens.map(token => {
                if (/^[\s\p{P}]+$/u.test(token)) return token; 
                
                const cleanWord = token.toLowerCase();
                
                // Check dictionary for exact match 
                if (dictionary[cleanWord]) return dictionary[cleanWord];
                
                // Handle plurals (simple -s pluralization check)
                if (cleanWord.endsWith('s')) {
                    const singular = cleanWord.slice(0, -1);
                    if (dictionary[singular]) return dictionary[singular];
                }
                
                // Default: Unknown word wrapper
                return `pos${cleanWord}ti`;
            });

            return formatCase(translatedTokens.join(''));
        }

        // 2. Pos -> Eng (Contextual lookup)
        function translateToEnglish(text) {
            if (!text.trim()) return "";
            
            const wordsOnly = text.match(/\b\w+\b/g) || [];
            const rawTokens = text.match(/(\w+|[^\w\s]|\s+)/g) || [];
            let translatedTokens = [];

            const findWordIndexInWordsOnly = (wordOnlyIndex, step) => {
                let index = wordOnlyIndex + step;
                return (index >= 0 && index < wordsOnly.length) ? index : null;
            };

            let wordOnlyIndex = 0; 

            for (let i = 0; i < rawTokens.length; i++) {
                let token = rawTokens[i];
                let cleanWord = token.toLowerCase();

                if (/\w+/.test(token)) {
                    
                    // --- 1. Handle invariant pronouns (contextual cases) ---
                    if (pronounCases[cleanWord]) {
                        let pronounData = pronounCases[cleanWord];
                        let englishWord = pronounData.subject; 

                        const nextWordOnlyIndex = findWordIndexInWordsOnly(wordOnlyIndex, 1);
                        const prevWordOnlyIndex = findWordIndexInWordsOnly(wordOnlyIndex, -1);
                        
                        const nextWord = nextWordOnlyIndex !== null ? wordsOnly[nextWordOnlyIndex].toLowerCase() : null;
                        const prevWord = prevWordOnlyIndex !== null ? wordsOnly[prevWordOnlyIndex].toLowerCase() : null;
                        
                        // Rule 1: Possessive Case (followed by a possessable noun: ending in -iz)
                        if (nextWord && possessiveWords.includes(nextWord)) {
                            englishWord = pronounData.possessive;
                        
                        // Rule 2: Objective Case (preceded by a verb: ending in -ek)
                        } else if (prevWord && verbWords.includes(prevWord) && cleanWord !== wordsOnly[0].toLowerCase()) {
                            englishWord = pronounData.object;
                        } 
                        
                        translatedTokens.push(englishWord);
                        wordOnlyIndex++; 
                        continue;
                    
                    // --- 2. Handle all other mapped words (nouns, verbs, adjectives, conjunctions) ---
                    } else if (reverseDictionary[cleanWord]) {
                        translatedTokens.push(reverseDictionary[cleanWord]);
                        wordOnlyIndex++;
                        continue;
                    }

                    // --- 3. Check for pos...ti (Unknown word wrapper) ---
                    const posTiMatch = cleanWord.match(/^pos(.+)ti$/);
                    if (posTiMatch) {
                        translatedTokens.push(posTiMatch[1]); // Return the inner word
                        wordOnlyIndex++;
                        continue;
                    }

                    // If it's a word but not in any list, just push the original token
                    translatedTokens.push(token);
                    wordOnlyIndex++;
                
                } else {
                    // 4. Keep original token (punctuation, spaces)
                    translatedTokens.push(token);
                }
            }

            return formatCase(translatedTokens.join(''));
        }

        // Helper for sentence case
        function formatCase(str) {
            return str.replace(/(?:^|[.!?]\s+)([a-z])/g, (c) => c.toUpperCase());
        }

        // Master Function
        function processTranslation() {
            const text = inputs.main.value;
            if (isEnglishToPosSha) {
                inputs.output.value = translateToPosSha(text);
            } else {
                inputs.output.value = translateToEnglish(text);
            }
        }

        // --- EVENTS ---
        inputs.main.addEventListener('input', processTranslation);

        inputs.clear.addEventListener('click', () => {
            inputs.main.value = '';
            inputs.output.value = '';
            inputs.main.focus();
        });

        inputs.swapBtn.addEventListener('click', () => {
            isEnglishToPosSha = !isEnglishToPosSha;
            
            inputs.swapIcon.classList.toggle('rotate-180-smooth');
            
            if (isEnglishToPosSha) {
                inputs.inputLabel.textContent = "English";
                inputs.inputLabel.className = "text-xs font-bold text-slate-400 uppercase tracking-widest transition-all";
                inputs.outputLabel.textContent = "Pos-Sha";
                inputs.outputLabel.className = "text-xs font-bold text-amber-600 uppercase tracking-widest transition-all";
                inputs.main.placeholder = "Type your thoughts here, twin...";
            } else {
                inputs.inputLabel.textContent = "Pos-Sha";
                inputs.inputLabel.className = "text-xs font-bold text-amber-600 uppercase tracking-widest transition-all";
                inputs.outputLabel.textContent = "English";
                inputs.outputLabel.className = "text-xs font-bold text-slate-400 uppercase tracking-widest transition-all";
                inputs.main.placeholder = "Type Pos-Sha here (e.g. egoril)...";
            }

            const currentIn = inputs.main.value;
            const currentOut = inputs.output.value;
            
            inputs.main.value = currentOut;
            inputs.output.value = currentIn;
            
            processTranslation();
        });

        inputs.copy.addEventListener('click', () => {
            if (!inputs.output.value) return;
            inputs.output.select();
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(inputs.output.value);
            } else {
                document.execCommand('copy');
            }

            const toast = document.getElementById('toast');
            toast.classList.remove('opacity-0', 'translate-y-[-20px]');
            setTimeout(() => toast.classList.add('opacity-0', 'translate-y-[-20px]'), 2000);
        });

        inputs.forgeBtn.addEventListener('click', () => {
            const root = inputs.forgeRoot.value.trim().toLowerCase();
            if (!root) return;
            let suffix = "";
            switch(inputs.forgeType.value) {
                case 'noun': suffix = "iz"; break;
                case 'verb': suffix = "ek"; break;
                case 'adj': suffix = "vum"; break; 
                case 'other': suffix = "ril"; break;
            }
            const cleanRoot = root.replace(/[^a-z0-9]/g, ''); 
            
            inputs.forgeOut.textContent = cleanRoot + suffix;
            inputs.forgeRes.classList.remove('hidden');
        });

        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) inputs.backToTop.classList.add('visible');
            else inputs.backToTop.classList.remove('visible');
        });

        window.addEventListener('load', () => {
            inputs.main.focus();
            inputs.main.placeholder = "Type your thoughts here, twin...";
        });

    </script>
</body>
</html>
